<app-page-title title="{{ title }}" />

<form [formGroup]="form">
  <div class="grid-container" formArrayName="alertNotes">
    @for (alert of alerts(); let i = $index; track $index) {
    <div class="grid-item" [formGroup]="notesFormArray.controls[i]">
      <mat-card
        class="custom-card"
        [class.ignored]="alert.ignored"
        appearance="outlined"
      >
        <mat-card-header>
          <mat-card-title
            ><b>{{ alert.parameter }} Result Alert</b></mat-card-title
          >
          <mat-card-subtitle
            >Alert on: {{ alert.time | formatDatetime }}</mat-card-subtitle
          >
        </mat-card-header>
        <mat-card-content>
          <div>
            <b>Alert information</b>
            <div class="line">
              {{ `${alert.site}, ${alert.floor}, ${alert.area}, ${alert.location}, ${alert.outlet}`}}
            </div>
          </div>

          <div class="line received">
            Received Value:
            {{ alert.readingValue
            }}{{
              alert.unitOfMeasurement
            }}
            ({{`Alert limit ${ alert.alertCondition } ${ alert.alertValue }${alert.unitOfMeasurement}`


            }})
          </div>
          <mat-form-field appearance="outline">
            <mat-label>Alert Note</mat-label>
            <input matInput formControlName="note" />
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
          <button matButton (click)="toggleIgnoreAlert(alert.readingResultId)">
            {{ alert.ignored ? "Undo" : "Ignore" }}
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    }
  </div>
</form>
